# -*- coding: utf-8 -*-
"""water_prediction.ipynb

Automatically generated by Colaboratory.

Original file is located at
    https://colab.research.google.com/drive/16eN6FzLQ6-es6kPGCDuI-tskdEC3oLzt
"""

# Commented out IPython magic to ensure Python compatibility.
# !pip install mplfinance
# !pip install chart_studio
# !pip install scikit-learn (for google colab)
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from matplotlib import dates
import mplfinance as mpf
# %matplotlib inline
import statsmodels.api as sm
import seaborn as sns
import csv

import chart_studio.plotly as py
import plotly.express as px
import plotly.graph_objects as go

import cufflinks as cf # Connects Plotly to Pandas
# Makes Plotly work in your Notebook
from plotly.offline import download_plotlyjs, init_notebook_mode, plot, iplot
init_notebook_mode(connected=True)
cf.go_offline()

import requests # Get URL data
from bs4 import BeautifulSoup # Manipulate URL data
import json
from pandas import DataFrame as df
from statsmodels.tsa.ar_model import AutoReg, ar_select_order
from statsmodels.tsa.api import acf, pacf, graphics
from sklearn.metrics import mean_absolute_error, mean_squared_error

#Inha water usage prediction for the next year (12 months)
df = pd.read_csv('sample_data/water.csv', parse_dates=True)
df.dtypes
df['usage'] = df['usage'].str.replace(',', '').astype(int)
df.set_index('date', inplace=True)
df = df.fillna(method='ffill')
df.isnull().values.any()
sns.set_style('darkgrid')
pd.plotting.register_matplotlib_converters()
sns.mpl.rc('figure', figsize=(12,6))
fig, ax = plt.subplots()
ax = df.plot(ax=ax)

model = AutoReg(df['usage'], 36)
model_fit = model.fit()

train_df = df.iloc[:212]
test_df = df.iloc[212:]

train_model = AutoReg(df['usage'], 96).fit(cov_type = 'HC0')

start=len(train_df)
end=len(train_df) + len(test_df) - 1

prediction = train_model.predict(start=start, end=end, dynamic=True)
forecast = train_model.predict(start=end+1, end=end+10, dynamic=True)
ax = forecast.plot(ax=ax)
print(forecast)